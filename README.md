**ëª¨ë“  ì‹¤ìŠµì€ [RabbitMQ Get Started ì„¹ì…˜](https://www.rabbitmq.com/tutorials/tutorial-one-java)ì„ ì°¸ê³ í•˜ì—¬ ì§„í–‰í•©ë‹ˆë‹¤.**
</br>

---

> Step01: Publisher - Consumer ë‹¨ìˆœ íŒ¨í„´ êµ¬í˜„

* Receiver - ë©”ì‹œì§€ ì†Œë¹„ì(Consumer)
* Sender - ë©”ì‹œì§€ ë°œí–‰ì(Publisher)
* ReceiverëŠ” RabbitMQì™€ ì—°ê²°, ë©”ì‹œì§€ë¥¼ ì „ì†¡í•˜ëŠ” ì²˜ë¦¬ ìˆ˜í–‰
* SenderëŠ” ë©”ì‹œì§€ íë¡œë¶€í„° í¼ë¸”ë¦¬ì…”(Receiver)ê°€ ì ì¬í•œ ë©”ì‹œì§€ë¥¼ ì†Œë¹„í•˜ëŠ” ì²˜ë¦¬ ìˆ˜í–‰

---

> Step02: Worker Queue ì‹¤ìŠµ

* ì‘ì—…(Task)ì„ ì‘ì—… í(Work queue)ì— ìŠ¤ì¼€ì¤„ë§í•˜ëŠ” í”„ë¡œê·¸ë¨
* ë¬¸ìì—´ê°’ì´ ì–´ë–¤ ë³µì¡í•œ ì‘ì—…ì´ë¼ê³  ê°€ì •í•  ë•Œ,
  * ex. Hello...ì´ë¼ê³  í•˜ë©´
  * .(dot) í•˜ë‚˜ëŠ” 1ì´ˆê°€ ì†Œìš”ë˜ëŠ” ì‘ì—…ì´ë¼ê³  ê°€ì •
    * ë”°ë¼ì„œ Hello...ëŠ” 3ì´ˆê°€ ê±¸ë¦¬ëŠ” ì‘ì—…ì´ë¼ê³  ê°€ì •
      * ì‹¤í–‰ ì¸ìê°’(args) í™œìš©í•´ì„œ Hello...ê³¼ ê°™ì€ ê°’ ì…ë ¥
</br>

- step02 ì •ë¦¬
  - durable
    - RabbitMQ ì„œë²„ê°€ ì¬ì‹œì‘ë˜ë”ë¼ë„ íì™€ ë©”ì‹œì§€ê°€ ìœ ì§€ë˜ë„ë¡ ì„¤ì •
    - durable=trueë¡œ ì„¤ì •í•˜ë©´, íê°€ ì¬ì‹œì‘ë˜ë”ë¼ë„ ë©”ì‹œì§€ê°€ ìœ ì§€ë¨
  - basicQos(1)
    - RabbitMQê°€ ì†Œë¹„ìë§ˆë‹¤ 1ê°œì”© ë©”ì‹œì§€ë¥¼ ì „ë‹¬í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì„¤ì •
    - RabbitMQëŠ” ê¸°ë³¸ì ìœ¼ë¡œ round-robin ë°©ì‹ìœ¼ë¡œ ë©”ì‹œì§€ë¥¼ ì „ë‹¬
      - ì¦‰, ì†Œë¹„ìì—ê²Œ ë©”ì‹œì§€ë¥¼ ì „ë‹¬í•  ë•Œ, íì— ìˆëŠ” ë©”ì‹œì§€ë¥¼ ìˆœì„œëŒ€ë¡œ ì „ë‹¬ 
  - prefetchCount
    - RabbitMQê°€ í•œ ë²ˆì— ì†Œë¹„ìì—ê²Œ ì „ë‹¬í•  ìˆ˜ ìˆëŠ” ë©”ì‹œì§€ì˜ ê°œìˆ˜
    - ê¸°ë³¸ê°’ì€ 1ë¡œ ì„¤ì •ë˜ì–´ ìˆìŒ
    - prefetchCount=1ë¡œ ì„¤ì •í•˜ë©´, ì†Œë¹„ìê°€ ì‘ì—…ì„ ì™„ë£Œí•˜ê¸° ì „ê¹Œì§€ ë‹¤ë¥¸ ì†Œë¹„ìì—ê²Œ ë©”ì‹œì§€ë¥¼ ì „ë‹¬í•˜ì§€ ì•ŠìŒ

- ì‹¤í–‰ë°©ë²•
  1. Workerë¥¼ ì—¬ëŸ¬ê°œ ì‹¤í–‰ì‹œí‚¤ê³  NewTaskë¥¼ ì „ì†¡
  2. ì—¬ëŸ¬ê°œì˜ Workerê°€ ì‘ì—…ì„ ë‚˜ëˆ„ì–´ ì²˜ë¦¬í•˜ëŠ” êµ¬ì¡° í™•ì¸

---

> Step03: Fanout Exchange ê¸°ë°˜ì˜ PUB-SUB êµ¬ì¡°

<img width="192" alt="Image" src="https://github.com/user-attachments/assets/434cb320-14bc-4f1b-abcd-a80893423e94" />

- Exchange
  - Publisherê°€ ë³´ë‚¸ ë©”ì‹œì§€ë¥¼ ì†Œë¹„ì(Consumer)ì—ê²Œ ì–´ë–»ê²Œ ì „ë‹¬í• ì§€ ê²°ì •í•˜ëŠ” ë¼ìš°íŒ… í—ˆë¸Œ
    - ì¢…ë¥˜
      - fanout: ëª¨ë“  ì†Œë¹„ìì—ê²Œ ë©”ì‹œì§€ë¥¼ ì „ë‹¬
      - direct: ë¼ìš°íŒ… í‚¤ê°€ ì •í™•íˆ ì¼ì¹˜í•˜ëŠ” íì—ë§Œ ì „ë‹¬
      - topic: ë¼ìš°íŒ… í‚¤ì˜ íŒ¨í„´ ë§¤ì¹­
        ```
        *.orange.*
        *.*.rabbit
        lazy.#.rabbit
        ```

_âœ… Step03ì—ì„œëŠ” `fanout` exchangeë¥¼ ì‚¬ìš©í•˜ì—¬ pub-sub êµ¬ì¡°ë¥¼ êµ¬í˜„í•œë‹¤._
</br>

```
  - EmitLog: ë©”ì‹œì§€ë¥¼ fanout íƒ€ì…ì˜ logs exchangeì— ë°œí–‰
  - ReceiveLogs: logs exchangeì— ë°”ì¸ë”©ëœ íì—ì„œ ë©”ì‹œì§€ë¥¼ ìˆ˜ì‹ 
  
  ì¦‰, ë©”ì‹œì§€ë¥¼ ë°œí–‰í•˜ë©´ ëª¨ë“  êµ¬ë…ìì—ê²Œ ë™ì¼í•œ ë©”ì‹œì§€ë¥¼ ë¸Œë¡œë“œìºìŠ¤íŒ…í•˜ëŠ” êµ¬ì¡°
```

- ì‹¤í–‰ë°©ë²•
  1. ReceiveLogsë¥¼ ì—¬ëŸ¬ ê°œ ì‹¤í–‰(ê°ê° ë‹¤ë¥¸ í„°ë¯¸ë„ì—ì„œ ì‹¤í–‰)
  2. EmitLog ì‹¤í–‰(ë©”ì‹œì§€ ì „ì†¡)
  3. fanout exchangeë¡œ ì„¤ì •ì„ í•´ë‘ì—ˆê¸° ë•Œë¬¸ì—, ëª¨ë“  íê°€ ë¸Œë¡œë“œìºìŠ¤íŒ… ë˜ëŠ” ì§€ í™•ì¸

### ì •ë¦¬

| êµ¬ë¶„       | ì˜ë¯¸                              |
|-----------|---------------------------------|
| `RabbitMQ`   | ë©”ì‹œì§€ ë¸Œë¡œì»¤ (ì „ì²´ ì‹œìŠ¤í…œ)                |
| `Exchange`   | ë©”ì‹œì§€ë¥¼ íì— ë¶„ë°°í•˜ëŠ” ì¤‘ê°„ ë¼ìš°íŒ… í—ˆë¸Œ          |
| `fanout`     | Exchangeì˜ íƒ€ì…(ì „íŒŒ ë°©ì‹)             |
| `logs`       | Exchangeì˜ ì´ë¦„ (ë„¤ì´ë°ì€ ê°œë°œìê°€ ì„ì˜ë¡œ ì •í•¨) |

---

> Step04: Topic Exchange ê¸°ë°˜ì˜ PUB-SUB êµ¬ì¡°

<img width="319" alt="Image" src="https://github.com/user-attachments/assets/d3be22c3-99a6-491c-8767-eb4b8e3b4130" />

- Exchange íƒ€ì…: `topic`
- `Routing key`ì— ë”°ë¼ ë©”ì‹œì§€ë¥¼ ë‹¤ë¥¸ íë¡œ ì „ë‹¬
- íŒ¨í„´ ê¸°ë°˜ ë§¤ì¹­: * (ë‹¨ì–´ í•˜ë‚˜), # (0ê°œ ì´ìƒ ë‹¨ì–´)

ì˜ˆì‹œ:
```
kern.* â†’ kern.critical, kern.infoëŠ” ë§¤ì¹­ / kern.system.errorëŠ” âŒ

*.orange.* â†’ quick.orange.rabbitë§Œ ë§¤ì¹­

lazy.# â†’ lazy.orange.rabbit, lazy.brown.fox, lazy ë“± ë‹¤ ë§¤ì¹­
```

step04ì—ì„œ í™•ì¸í•  ì 
```
- ReceiveLogsTopic "*.orange.*"ëŠ” quick.orange.rabbit ë©”ì‹œì§€ë¥¼ ìˆ˜ì‹ 

- ReceiveLogsTopic "quick.#"ëŠ” quick.orange.rabbit, quick.brown.fox ë“± prefixê°€ quickì¸ ë©”ì‹œì§€ë¥¼ ìˆ˜ì‹ 
```

---

### (Appendix 2) Binding Key vs. Routing Key

| í•­ëª© | routingKey | bindingKey |
| --- | --- | --- |
| ëˆ„ê°€ ì„¤ì •í•¨? | **Producer (EmitLogTopic)** | **Consumer ìª½ í ì„¤ì • ì‹œ (ReceiveLogsTopic)** |
| ì–¸ì œ ì‚¬ìš©ë¨? | ë©”ì‹œì§€ë¥¼ **ë³´ë‚¼ ë•Œ** | íë¥¼ ìµìŠ¤ì²´ì¸ì§€ì— **ë°”ì¸ë”©í•  ë•Œ** |
| ì–´ë–¤ ì—­í• ? | ë©”ì‹œì§€ê°€ ì–´ë–¤ "ì£¼ì†Œ"ë¡œ ê°ˆì§€ë¥¼ ì§€ì • | ì–´ë–¤ ë¼ìš°íŒ… í‚¤ì˜ ë©”ì‹œì§€ë¥¼ ìˆ˜ì‹ í• ì§€ë¥¼ ê²°ì • |
| ì ìš© Exchange | `direct`, `topic` ë“±ì—ì„œ ì¤‘ìš” | `direct`, `topic` ë“±ì—ì„œ í•„ìˆ˜ ì¡°ê±´ |
| ì˜ˆì‹œ | `"quick.orange.rabbit"` | `"*.orange.*"` or `"quick.#"` |

### (Appendix 2) ë°ì´í„° ìœ ì‹¤ ì—†ì´ ë” ê°•ë ¥í•œ ì˜ì†ì„±ì„ ë³´ì¥í•˜ëŠ” ë°©ë²•ì€?

[ğŸ“š Consumer Acknowledgements and Publisher Confirms | RabbitMQ](https://www.rabbitmq.com/docs/confirms)

